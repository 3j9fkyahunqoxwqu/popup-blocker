<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Popup blocking test suite :: tools.add0n.com</title>
    <base target="_blank" />
  </head>
  <body>
    <style>
      body {
        font-size: 13px;
        font-family: arial,sans-serif;
      }
      li {
        margin: 5px 0;
        display: flex;
        align-items: center;
      }
      iframe,
      input,
      a {
        border: none;
        background-color: #ddd;
        text-decoration: none;
        color: #000;
        display: inline-block;
        text-align: center;
        font-size: 90%;
        cursor: pointer;
        outline: none;
        margin-right: 5px;
        padding: 5px 0;
      }
      input {
        padding: 5px;
      }
      iframe:active,
      input:active,
      a:hover {
        opacity: 0.5;
      }
      li a,
      li input {
        min-width: 100px;
      }
      iframe {
        border: none;
        width: 100px;
        height: 23px;
        vertical-align: middle;
        padding: 0;
      }
    </style>
    <script>
      'use strict';
      var pointer = window.open;
      console.error(pointer)

      function method1 () {
        var newwindow = pointer('', 'result', 'status=1,width=700,height=500,menubar=yes');
        newwindow.document.open('text/html', 'replace');
        newwindow.document.write('<html><body>test page / 1 ...<body/><html/>');
        newwindow.document.write('<script> document.onreadystatechange = function(){   if(document.readyState=="loaded" || document.readyState=="complete") window.print(); } <' + '/script>');
        newwindow.document.close();
      }
      function method2 () {
        var newwindow = pointer('', 'result', 'status=1,width=700,height=500,menubar=yes');
        newwindow.document.open('text/html', 'replace');
        newwindow.document.write('<html><body>test page / 2...<body/><html/>');
        newwindow.document.close();
      }
      function method3 (url, title, w, h) {
        var dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : screen.left;
        var dualScreenTop = window.screenTop !== undefined ? window.screenTop : screen.top;
        var width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;
        var height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;

        var left = ((width / 2) - (w / 2)) + dualScreenLeft;
        var top = ((height / 2) - (h / 2)) + dualScreenTop;
        var newWindow = window.open(url, title, 'scrollbars=yes, width=' + w + ', height=' + h + ', top=' + top + ', left=' + left);

        // Puts focus on the newWindow
        if (window && window.focus) {
          newWindow.focus();
        }
      }
      function method7 () {
        var c = document.createElement('a');
        var d = document.createEvent('MouseEvents');
        c.href = 'about:blank', d.initMouseEvent('click', !1, !0, window, 0, 0, 0, 0, 0, !0, !1, !1, !0, 0, null), c.dispatchEvent(d);
      }
      function method10 () {
        var a = document.createElement('a');
        a.target="_blank";
        a.href='about:blank';
        document.body.appendChild(a);
        var b = new MouseEvent("click", {
          view: window,
          bubbles: !1,
          cancelable: !1
        });
        console.error(b)
        a.dispatchEvent(b);
      }

      function overwrite1 () {
        try {
          Object.defineProperty(window, 'open', {
            writable: false,
            value: function () {
              alert('window.open is bypassed; still your popup-blocker should not allow popups');
            }
          });
        }
        catch (e) {
          alert('Error: ' + e.message);
        }
      }

      function overwrite2 () {
        try {
          MouseEvent.prototype.preventDefault = function () {}
        }
        catch (e) {
          alert('Error: ' + e.message);
        }
      };
    </script>
    <h1>Test the effectiveness of your popup blocker add-on</h1>
    <ul>
      <li><input type="button" onclick="method1()" value="Method 1/1"> opening a new about:blank popup window and then fill the content using JavaScript engine; part 1</li>
      <li><input type="button" onclick="method2()" value="Method 1/2"> opening a new about:blank popup window and then fill the content using JavaScript engine; part 2 (test your popup blocker to see if it can differentiate different sources with the "about:blank" origin)</li>
      <li><input type="button" onclick="window.open('about:blank');" value="Method 2/1"> opening a new popup tab using window.open method</li>
      <li><input type="button" onclick="pointer('about:blank');" value="Method 2/2"> opening a new popup tab using a predefined pointer to window.open method</li>
      <li><input type="button" onclick="method3('about:blank, 'new window', 600, 600)" value="Method 3"> opening a new popup window and passing arguments to it</li>
      <li><a href='about:blank' target="_blank">Method 4</a> opening new popup window using target="_blank" method over links</li>
      <li><iframe sandbox="allow-forms allow-popups allow-scripts allow-same-origin" src="./popup-blocker-iframe.html"></iframe> opening a new popup tab using iframe with "base" header set to target="_parent" method</li>
      <li><a href='about:blank'>Method 6</a> opening a new popup tab using link with "base" header set to target="_blank"</li>
      <li><input type="button" onclick="method7()" value="Method 7"> opening a new about:blank popup window using createEvent method</li>
      <li><a id="id1" href='about:blank' target="_blank">Method 8/1</a> opening new popup window using target="_blank" method over links powered by stop propagation</li>
      <script>
        document.getElementById('id1').addEventListener('click', function (e) {
          e.stopPropagation();
        });
      </script>
      <li><a id="id2" href='about:blank' target="_blank">Method 8/2</a> opening new popup window using target="_blank" method over links powered by stop propagation</li>
      <script>
        document.getElementById('id2').addEventListener('click', function (e) {
          e.stopImmediatePropagation();
        });
      </script>
      <li><span id="id3"> click the button to create iframe, then click on the generated link</li>
      <script>
        var f = document.createElement('iframe');
        var elem = document.getElementById('id3');
        elem.parentNode.insertBefore(f, elem);
        f.contentDocument.write('<html><head><style>body{display: flex; align-items: center; justify-content: center; margin: 0;}</style></head><body><a href="about:blank" target="_blank">Method 9</a>');
        f.contentDocument.write('</body></html>');
        f.contentDocument.documentElement.appendChild(document.querySelector('style').cloneNode(true));
        f.contentDocument.close();
      </script>
      <li><input type="button" onclick="method10()" value="Method 10"> creating new element and dispatching an uncancellable click event</li>
    </ul>
    <p>
      Click <input type="button" onclick="overwrite1();" value="here"> to overwrite "window.open" and try tests one more time.
    </p>
    <p>
      Click <input type="button" onclick="overwrite2();" value="here"> to overwrite "MouseEvent.prototype.preventDefault" and try tests one more time.
    </p>

    <p>It is recommended to use <b>Popup Blocker (Ultimate)</b> add-on for the best experience; <a href="https://chrome.google.com/webstore/detail/aefkmifgmaafnojlojpnekbpbmjiiogg">Chrome</a>, <a href="https://addons.mozilla.org/firefox/addon/popup-blocker/">Firefox</a>, and <a href="https://addons.opera.com/en/extensions/details/popup-blocker-ultimate/">Opera</a>.
    </p>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-33732869-1', 'auto');
      ga('send', 'pageview');

    </script>
  </body>
</html>
